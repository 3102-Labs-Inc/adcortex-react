<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: AsyncAdcortexChatClient</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: AsyncAdcortexChatClient</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>AsyncAdcortexChatClient<span class="signature">(session_info, context_template<span class="signature-attributes">opt</span>, api_key<span class="signature-attributes">opt</span>, timeout<span class="signature-attributes">opt</span>, disable_logging<span class="signature-attributes">opt</span>, max_queue_size<span class="signature-attributes">opt</span>, circuit_breaker_threshold<span class="signature-attributes">opt</span>, circuit_breaker_timeout<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h2>
        
            <div class="class-description">Asynchronous chat client for ADCortex API with message queue and circuit breaker support.

This client provides asynchronous message processing with features like:
- Message queue management with FIFO behavior
- Circuit breaker pattern for error handling
- Batch processing of messages
- Automatic retries with exponential backoff
- Non-blocking task management for high-throughput scenarios</div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="AsyncAdcortexChatClient"><span class="type-signature"></span>new AsyncAdcortexChatClient<span class="signature">(session_info, context_template<span class="signature-attributes">opt</span>, api_key<span class="signature-attributes">opt</span>, timeout<span class="signature-attributes">opt</span>, disable_logging<span class="signature-attributes">opt</span>, max_queue_size<span class="signature-attributes">opt</span>, circuit_breaker_threshold<span class="signature-attributes">opt</span>, circuit_breaker_timeout<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Creates a new instance of the AsyncAdcortexChatClient.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>session_info</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last">Session and user information for ad targeting</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>context_template</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    DEFAULT_CONTEXT_TEMPLATE
                
                </td>
            

            <td class="description last">Template string for formatting ad context</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>api_key</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">null</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    null
                
                </td>
            

            <td class="description last">API key for ADCortex API, reads from environment if not provided</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>timeout</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    10
                
                </td>
            

            <td class="description last">Request timeout in seconds (default is 10 seconds, longer than synchronous client)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>disable_logging</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last">Whether to disable logging</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>max_queue_size</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    100
                
                </td>
            

            <td class="description last">Maximum number of messages in the queue</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>circuit_breaker_threshold</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    5
                
                </td>
            

            <td class="description last">Number of consecutive errors before circuit opens</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>circuit_breaker_timeout</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    120
                
                </td>
            

            <td class="description last">Time in seconds before circuit resets (2 minutes)</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>













<h5>Throws:</h5>

        

<dl>
    <dt>
        <div class="param-desc">
        if ADCORTEX_API_KEY is not set and not provided
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl>
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>


    






    <h5>Example</h5>
    
    <pre class="prettyprint"><code>```javascript
// Create session info
const sessionInfo = SessionInfoSchema.parse({
  session_id: "session123",
  character_name: "Assistant",
  character_metadata: "Friendly AI assistant",
  user_info: {
    user_id: "user456",
    age: 25,
    gender: "male",
    location: "US",
    language: "en",
    interests: ["technology", "gaming"]
  },
  platform: {
    name: "MyApp",
    varient: "1.0.0"
  }
});

// Create async chat client
const chatClient = new AsyncAdcortexChatClient(sessionInfo);

// Process a message
await chatClient.__call__(Role.user, "I need a new gaming laptop");

// Check for ads
const latestAd = chatClient.get_latest_ad();
if (latestAd) {
  const context = chatClient.create_context();
  console.log("Ad Context:", context);
}
```</code></pre>



    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="__call__"><span class="type-signature">(async) </span>__call__<span class="signature">(role, content)</span><span class="type-signature"> &rarr; {Promise.&lt;void>}</span></h4>
    

    



<div class="description">
    Processes a chat message and potentially fetches relevant ads asynchronously.

This method adds the message to the processing queue. If conditions are met
(client is idle, message is from user, circuit breaker is closed, no task is running),
it will asynchronously process the queue to fetch relevant advertisements.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>role</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The role of the message sender (user or AI)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>content</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The content of the message</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    A Promise that resolves when the message has been processed
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;void></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>```javascript
// Process a user message
await asyncChatClient.__call__(Role.user, "I need a gaming laptop under $1500");

// Process an AI response (typically won't trigger ad fetch)
await asyncChatClient.__call__(Role.ai, "I can help you find gaming laptops in that price range!");
```</code></pre>



        
            

    

    
    <h4 class="name" id="create_context"><span class="type-signature"></span>create_context<span class="signature">()</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    Creates a context string based on the latest ad.

This method uses the context template to create a string that can be
integrated into chat responses to present the ad in a natural way.
Unlike the synchronous client version, this method uses the latest_ad
property directly without requiring it as a parameter.
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    Formatted context string with ad information, or empty string if no ad is available
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>```javascript
// After processing a message
if (chatClient.latest_ad) {
  const context = chatClient.create_context();
  console.log(context);
  // Output: "Here is a product the user might like: Gaming Laptop - High performance gaming: Check it out!"
}
```</code></pre>



        
            

    

    
    <h4 class="name" id="get_latest_ad"><span class="type-signature"></span>get_latest_ad<span class="signature">()</span><span class="type-signature"> &rarr; {Object|null}</span></h4>
    

    



<div class="description">
    Gets the latest ad and clears it from memory.

This method is designed to be called after processing messages to retrieve
any matched advertisements. Once retrieved, the ad is cleared from memory.
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    The latest ad, or null if no ad was found
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>
|

<span class="param-type">null</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>```javascript
await asyncChatClient.__call__(Role.user, "I need a gaming laptop");
const ad = asyncChatClient.get_latest_ad();
if (ad) {
  console.log(`Found ad: ${ad.ad_title}`);
} else {
  console.log("No relevant ads found");
}
```</code></pre>



        
            

    

    
    <h4 class="name" id="get_state"><span class="type-signature"></span>get_state<span class="signature">()</span><span class="type-signature"> &rarr; {<a href="global.html#ClientState">ClientState</a>}</span></h4>
    

    



<div class="description">
    Gets the current client state.
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    Current state of the client (IDLE or PROCESSING)
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="global.html#ClientState">ClientState</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="is_healthy"><span class="type-signature"></span>is_healthy<span class="signature">()</span><span class="type-signature"> &rarr; {boolean}</span></h4>
    

    



<div class="description">
    Checks if the client is in a healthy state.

A client is considered healthy when:
- The circuit breaker is closed (not in error state)
- The message queue is not full
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    Boolean indicating if the client is healthy
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">boolean</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>```javascript
if (!asyncChatClient.is_healthy()) {
  console.log("Client is in an unhealthy state, waiting before sending more messages...");
  // Implement backoff strategy
}
```</code></pre>



        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-%257BAdSchema%257D.html">{AdSchema}</a></li><li><a href="module-%257BAdcortexChatClient%257D.html">{AdcortexChatClient}</a></li><li><a href="module-%257BAsyncAdcortexChatClient%257D.html">{AsyncAdcortexChatClient}</a></li><li><a href="module-%257BGender%257D.html">{Gender}</a></li><li><a href="module-%257BInterest%257D.html">{Interest}</a></li><li><a href="module-%257BLanguage%257D.html">{Language}</a></li><li><a href="module-%257BMessageSchema%257D.html">{MessageSchema}</a></li><li><a href="module-%257BRole%257D.html">{Role}</a></li><li><a href="module-%257BSessionInfoSchema%257D.html">{SessionInfoSchema}</a></li></ul><h3>Classes</h3><ul><li><a href="AdcortexChatClient.html">AdcortexChatClient</a></li><li><a href="AsyncAdcortexChatClient.html">AsyncAdcortexChatClient</a></li><li><a href="CircuitBreaker.html">CircuitBreaker</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ClientState">ClientState</a></li><li><a href="global.html#ClientState%255Bundefined%255D">ClientState[undefined]</a></li><li><a href="global.html#Gender">Gender</a></li><li><a href="global.html#Interest">Interest</a></li><li><a href="global.html#Language">Language</a></li><li><a href="global.html#Role">Role</a></li><li><a href="global.html#utcNow">utcNow</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Apr 28 2025 16:22:53 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>